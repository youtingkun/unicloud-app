<view class="page data-v-199b258e"><alert-code vue-id="731bbaed-1" data-ref="alertCode" class="data-v-199b258e vue-ref" bind:__l="__l"></alert-code><uni-notice-bar vue-id="731bbaed-2" showIcon="true" iconType="info" text="管理员(admin)拥有任何权限,权限控制对其无效。" class="data-v-199b258e" bind:__l="__l"></uni-notice-bar><view class="uni-title tip data-v-199b258e">一、示例简介<text class="data-v-199b258e">\n 演示了：
		1.用户可以编辑自己的个人资料。
		2.审核员，审核资料的username字段。
		3.审核期间用户不能修改username字段。
		4.未登陆的游客看不到用户的phone字段 \n \n</text>二、需要的资源，schema路径:<text class="data-v-199b258e">\n uniCloud/database/permission-test.schema.json \n \n</text>三、数据的介绍，表字段:<text class="data-v-199b258e">\n username(姓名), state(审核状态), nickname(昵称), phone(手机号码)</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['toDemo',['$event']]]]]}}" bindtap="__e" class="data-v-199b258e">查看示例</button><view class="tips data-v-199b258e"><text class="data-v-199b258e">DB Schema的permission规则，分为两部分，一边是对操作数据的指定，一边是对角色的指定，规则中对两者进行关联，匹配则校验通过。</text></view><page-head vue-id="731bbaed-3" title="表级权限控制" subTitle="包括增删改查四种权限，分别称为：create、delete、update、read" class="data-v-199b258e" bind:__l="__l"></page-head><uni-section vue-id="731bbaed-4" title="根据true和false控制数据库的相关操作" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-5" codes="{{$root.a0}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释：允许任何账户读取本表</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['getFn',['uid,username,nickname,state']]]]]}}" bindtap="__e" class="data-v-199b258e">读取表全部数据</button><view class="uni-title pl10 data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-6" codes="{{$root.a1}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释： 禁止任何账户执行删除表中的记录操作</text><text class="data-v-199b258e">\n 但管理员账号不受schema限制，可在底部工具条切换成管理员角色体验</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['removeFn',['$event']]]]]}}" bindtap="__e" class="data-v-199b258e">删除全部记录数据</button><uni-section vue-id="731bbaed-7" title="根据操作的用户id、角色和权限数组" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-8" codes="{{$root.a2}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释：表示仅已登陆后的用户才能执行创建操作</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['addFn']]]]}}" bindtap="__e" class="data-v-199b258e">创建一条数据</button><uni-section vue-id="731bbaed-9" title="根据数据库中的目标数据记录" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 uni-common-mt data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-10" codes="{{$root.a3}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释：\n 1.数据创建者 \n 2.角色为审核员 \n 3.拥有编辑权限; \n 三种情况，拥有字段更新权限</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['updateFn',[['o',['nickname','新昵称']],'uid == $env.uid']]]]]}}" bindtap="__e" class="data-v-199b258e"><text class="data-v-199b258e">更新nickname="新昵称"\n（仅当前用户为创建者的数据）</text></button><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['updateFn',[['o',['nickname','新昵称']]]]]]]}}" bindtap="__e" class="data-v-199b258e"><text class="data-v-199b258e">更新nickname="新昵称"\n（表中全部数据）</text></button><page-head vue-id="731bbaed-11" title="字段级权限控制" class="data-v-199b258e" bind:__l="__l"></page-head><uni-section vue-id="731bbaed-12" title="修改指定字段需要特殊角色" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 uni-common-mt data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-13" codes="{{$root.a4}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['updateFn',[['o',['state',1]]]]]]]}}" bindtap="__e" class="data-v-199b258e"><text class="data-v-199b258e">更新 state = 1</text></button><view class="uni-title pl10 uni-common-mt data-v-199b258e"><text class="data-v-199b258e">含义解释：限角色为审核员才能更新，字段state</text></view><uni-section vue-id="731bbaed-14" title="修改指定字段时,当前记录的某个字段应当满足某种条件" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 uni-common-mt data-v-199b258e"><view class="data-v-199b258e">配置规则：</view><scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-15" codes="{{$root.a5}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释：表示执行该操作需要满足，update的表级权限控制外，还需要满足正在被操作的记录的字段state!=0</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['updateFn',[['o',['username','新姓名']]]]]]]}}" bindtap="__e" class="data-v-199b258e"><text class="data-v-199b258e">更新 username:'新姓名' \n(表中全部数据)</text></button><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['updateFn',[['o',['username','新姓名']],'uid == $env.uid']]]]]}}" bindtap="__e" class="data-v-199b258e"><text class="data-v-199b258e">更新 username:'新姓名' \n(仅当前角色为创建者的数据)</text></button><uni-section vue-id="731bbaed-16" title="控制特殊字段不可读" type="circle" class="data-v-199b258e" bind:__l="__l"></uni-section><view class="uni-title pl10 uni-common-mt data-v-199b258e">配置规则：<scroll-view class="code-box data-v-199b258e" scroll-x="{{true}}"><show-code vue-id="731bbaed-17" codes="{{$root.a6}}" class="data-v-199b258e" bind:__l="__l"></show-code></scroll-view><text class="data-v-199b258e">含义解释：综合表级任何用户可读的条件下，新增了未登录游客不能读取phone字段</text></view><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['getFn',['uid,username,nickname,state']]]]]}}" bindtap="__e" class="data-v-199b258e">读不带phone字段的数据</button><button plain="{{true}}" type="primary" data-event-opts="{{[['tap',[['getFn',['uid,username,nickname,state,phone']]]]]}}" bindtap="__e" class="data-v-199b258e">读带phone字段的数据</button><set-permission bind:change="__e" vue-id="731bbaed-18" data-ref="set-permission" data-event-opts="{{[['^change',[['changePermission']]]]}}" class="data-v-199b258e vue-ref" bind:__l="__l"></set-permission></view>